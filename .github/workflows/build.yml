name: Build

on:
  push:

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x, 20.x, 22.x]
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
      #- name: Enable user namespace cloning
      #  run: sudo sysctl -w kernel.unprivileged_userns_clone=1
      - name: Setup setuid sandbox
        run: |
          # cd to Puppeteer cache directory (adjust the path if using a different cache directory).
          cd ~/.cache/puppeteer/chrome/linux-<version>/chrome-linux64/
          sudo chown root:root chrome_sandbox
          sudo chmod 4755 chrome_sandbox
          # copy sandbox executable to a shared location
          sudo cp -p chrome_sandbox /usr/local/sbin/chrome-devel-sandbox
          # export CHROME_DEVEL_SANDBOX env variable
          export CHROME_DEVEL_SANDBOX=/usr/local/sbin/chrome-devel-sandbox
      - name: Build
        run: make
